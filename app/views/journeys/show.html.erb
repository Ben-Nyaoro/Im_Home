<div class="container">
	<div class="card-trip m-4">
		<div style="width: 100%; height: 200px;"
			data-controller="mapbox"
			data-mapbox-markers-value="<%= @markers.to_json %>"
			data-mapbox-markers1-value="<%= @markers1.to_json %>"
			data-mapbox-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
		</div>
		<div class="card-trip-infos">
			<div d-flex>
				<ul class="list-inline">
					<li class="dark-gray"><b>From:</b> <%= @journey.starting_point.address_line1 %></li>
					<li class="dark-gray"><b>To:</b> <%= @journey.destination.address_line1 %> </li>
					<li class="dark-gray"><b>Started at:</b> <%= startTime = @journey.created_at.strftime('%d-%b-%Y %H:%M:%S') %> </li>
					<li class="dark-gray"><b>Estimated:</b> <%= timeestimate = @journey.time_estimate %> Mins </li>
					<li> <% endtime = @journey.created_at + (@journey.time_estimate * 60) %></h6>
					<li class="text-white fs-6"><span class="counter">
						<% if endtime >= Time.now %>
							<%= remainingtime = endtime - Time.now %>
						<% else %>
							<%= 1 %>
						<% end %>
            <% if remainingtime == 2 %>
            <% TwilioClient.new.send_text('+4915784477390', "#{@user.name} has not ended their journey. Please get in touch with them.") %>
            <% end %>
            </span>
					</li>
				</ul>
			</div>

		<div id="app" data-controller="timer">
		</div>
		<div>
			<%= javascript_pack_tag 'timer'%>
			<% buddy = Buddy.find_or_create_by(id: @journey.buddy_id)%>
			<% if buddy.profile_picture.attached? %>
				<%= cl_image_tag(buddy.profile_picture.key, class: "rounded-circle card-trip-user avatar-bordered") %>
			<% else %>
				<%= cl_image_tag("cld-sample", class: "rounded-circle card-trip-user avatar-bordered" ) %>
			<% end %>
			<p class="card-trip-pricing relative"><%= buddy.name %></p>
		</div>
		</div><hr>
		<div class= "d-flex justify-content-around align-items-center m-2">
			<div class="btn button-oval button-journey-show"> <%= link_to "End Journey", journey_path(@journey), :class => "btn", method: :delete, data: { message: "Your buddy will be informed" } %></div>
			<div class="btn button-oval ml-1"> <%= link_to 'Update', edit_journey_path(@journey), :class => "btn" %></div>
		</div>
</div>
